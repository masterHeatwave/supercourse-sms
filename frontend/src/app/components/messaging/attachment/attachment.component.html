<div class="attachment-wrapper">

  <!-- Hidden File Input -->
  <input
    #fileInput
    type="file"
    [accept]="acceptedFileTypes"
    [multiple]="true"
    (change)="onFilesSelected($event)"
    style="display:none"
  />

  <!-- Upload Button -->
  <p-button
    [icon]="getButtonIcon()"
    [rounded]="true"
    [text]="true"
    [disabled]="disabled || isUploading"
    [pTooltip]="getTooltipText()"
    tooltipPosition="top"
    [loading]="isUploading"
    (onClick)="openFileDialog()"
    styleClass="attachment-button"
  ></p-button>

  <!-- Overlay During Upload -->
  <div *ngIf="isUploading" class="upload-progress-overlay">

    <p-card styleClass="upload-progress-card">

      <ng-template pTemplate="content">

        <!-- HEADER -->
        <div class="upload-header">
          <div class="flex align-items-center gap-2">
            <i class="pi pi-cloud-upload upload-icon"></i>

            <div class="flex flex-column">
              <span class="upload-title">Uploading Files</span>
              <span class="upload-subtitle">
                {{selectedFiles.length}} file(s) â€¢ {{uploadProgress}}%
              </span>
            </div>
          </div>

          <div class="upload-percentage">{{uploadProgress}}%</div>
        </div>

        <!-- PROGRESS BAR -->
        <div class="progress-container">
          <p-progressBar
            [value]="uploadProgress"
            [showValue]="false"
            styleClass="custom-progress-bar"
          ></p-progressBar>
        </div>

        <!-- FILE LIST -->
        <div class="file-list-container">

          <div class="file-list-header">
            <i class="pi pi-file text-xs"></i>
            <span>Files</span>
          </div>

          <p-scrollPanel
            [style]="{width: '100%', height: '120px'}"
            styleClass="custom-scrollpanel"
          >
            <div class="file-list">

              <div
                *ngFor="let file of selectedFiles"
                class="file-item"
                [@fileItemAnimation]
              >
                <div class="file-item-content">
                  <div class="file-icon-wrapper">
                    <i [class]="AttachmentUtils.getFileIcon(file.name) + ' file-type-icon'"></i>
                  </div>

                  <div class="file-details">
                    <span class="file-name" [pTooltip]="file.name" tooltipPosition="top">
                      {{file.name}}
                    </span>
                    <span class="file-size">
                      {{AttachmentUtils.formatFileSize(file.size)}}
                    </span>
                  </div>
                </div>

                <div class="file-status">
                  <i *ngIf="uploadProgress < 100" class="pi pi-spin pi-spinner status-icon uploading"></i>
                  <i *ngIf="uploadProgress === 100" class="pi pi-check-circle status-icon success"></i>
                </div>
              </div>

            </div>
          </p-scrollPanel>
        </div>

        <!-- FOOTER -->
        <div class="upload-footer">

          <div class="flex align-items-center gap-2">
            <i class="pi pi-clock text-xs text-500"></i>
            <span class="text-xs text-500">
              {{uploadProgress < 100 ? 'Uploading...' : 'Upload complete!'}}
            </span>
          </div>

          <p-tag
            [value]="uploadProgress < 100 ? 'In Progress' : 'Completed'"
            [severity]="uploadProgress < 100 ? 'info' : 'success'"
            styleClass="upload-status-tag"
          ></p-tag>

        </div>

      </ng-template>
    </p-card>
  </div>
</div>
