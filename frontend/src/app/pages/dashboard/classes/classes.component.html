<ng-container *ngIf="classes$ | async as classes">
  <div class="flex flex-column gap-4 px-4">
    <!-- Show empty state if no classes -->
    <ng-container *ngIf="!isLoading && totalRecords === 0; else classesTable">
      <div class="flex flex-column align-items-center justify-content-center py-8">
        <div class="text-center mb-4">
          <i class="pi pi-users text-6xl text-300 mb-3"></i>
          <h2 class="text-2xl font-bold text-700 mb-2">{{ 'classes.empty.title' | translate }}</h2>
          <p class="text-600 mb-4">{{ 'classes.empty.message' | translate }}</p>
        </div>
        <p-button 
          *ngIf="canAddClasses"
          [label]="'classes.empty.add_class' | translate" 
          icon="pi pi-plus" 
          (onClick)="navigateToCreate()"
          styleClass="p-button-lg">
        </p-button>
        <p-button 
          *ngIf="!canAddClasses"
          [label]="'Cannot add classes: Select a current academic year'" 
          icon="pi pi-exclamation-triangle" 
          disabled="true"
          styleClass="p-button-lg p-button-warning">
        </p-button>
      </div>
    </ng-container>

    <!-- Show table if classes exist -->
    <ng-template #classesTable>
      <div class="flex justify-content-end mb-3 mt-3">
        <p-button 
          *ngIf="canAddClasses"
          icon="pi pi-plus" 
          styleClass="p-button-text border-circle" 
          (onClick)="navigateToCreate()"
          pTooltip="Add a new class"
          tooltipPosition="bottom"> 
        </p-button>
        <p-button icon="pi pi-download" styleClass="p-button-text border-circle ml-2" (onClick)="downloadExcel()"> </p-button>
        <p-button
          [icon]="(viewMode$ | async) === 'list' ? 'pi pi-th-large' : 'pi pi-list'"
          styleClass="p-button-text border-circle ml-2"
          (onClick)="toggleViewMode()"
        >
        </p-button>
      </div>
      <div class="position-relative">
        <!-- Add spinner with overlay when loading -->
        <app-spinner *ngIf="isLoading" [overlay]="true"></app-spinner>

        <app-primary-table
          [data]="classes"
          [columns]="tableColumns"
          [rows]="10"
          [totalRecords]="totalRecords"
          [viewMode]="(viewMode$ | async) || 'list'"
          [showProfileImage]="false"
          (pageChange)="onPageChange($event)"
          (rowsPerPageChange)="onRowsPerPageChange($event)"
          (rowSelect)="onClassSelect($event)"
          (editRow)="onEditClass($event)"
          (viewRow)="onClassSelect($event)"
          (deleteRow)="onDeleteClass($event)"
          (restoreRow)="onRestoreClass($event)"
          (sortChange)="onSortChange($event)"
        >
        </app-primary-table>
      </div>
    </ng-template>
  </div>
</ng-container>
